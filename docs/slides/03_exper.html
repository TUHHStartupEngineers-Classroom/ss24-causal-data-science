<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.554">

  <meta name="author" content="Christoph Ihl">
  <title>(3) Randomized Experiments</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #e1e4e8; background-color: #005e73; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #e1e4e8; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #ff7e15; } /* Attribute */
    code span.bn { color: #5affc5; } /* BaseN */
    code span.bu { color: #ff7e15; } /* BuiltIn */
    code span.cf { color: #ff7e15; } /* ControlFlow */
    code span.ch { color: #5affc5; } /* Char */
    code span.cn { color: #5affc5; } /* Constant */
    code span.co { color: #a8968c; } /* Comment */
    code span.cv { color: #a8968c; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #f97583; } /* DataType */
    code span.dv { color: #5affc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #f97583; font-weight: bold; } /* Extension */
    code span.fl { color: #5affc5; } /* Float */
    code span.fu { color: #00c1d4; } /* Function */
    code span.im { color: #9ecbff; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #f97583; } /* Keyword */
    code span.op { color: #e1e4e8; } /* Operator */
    code span.ot { color: #5affc5; } /* Other */
    code span.pp { color: #f97583; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #5affcf; } /* SpecialChar */
    code span.ss { color: #9ecbff; } /* SpecialString */
    code span.st { color: #5affc5; } /* String */
    code span.va { color: #ffab70; } /* Variable */
    code span.vs { color: #9ecbff; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../assets/fonts.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/simplemenu/SimpleMenu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-toggle-dark-mode/toggledarkmode.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-fullscreen-button/FullscreenButton.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" type="image/svg" sizes="16x16" href="https://raw.githubusercontent.com/christophihl/TIE_website/main/assets/images/icon.svg">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-state="hide-menubar" class="quarto-title-block center">
  <h1 class="title">(3) Randomized Experiments</h1>
  <p class="subtitle">Causal Data Science for Business Analytics</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christoph Ihl 
</div>
        <p class="quarto-title-affiliation">
            Hamburg University of Technology
          </p>
    </div>
</div>

  <p class="date">Monday, 24. June 2024</p>
</section>
<section>
<section id="randomized-experiments" class="title-slide slide level1 center" data-stack-name="Randomization">
<h1>Randomized Experiments</h1>
<div class="cell">
<style type="text/css">
div.callout-note{border-left-color:#00C1D4 !important}div.callout-note.callout-style-default .callout-title{background-color:#005e73;color:white}.callout.callout-style-default{border-left:solid #005e73 .3rem;border-right:solid 1px #005e73;border-top:solid 1px #005e73;border-bottom:solid 1px #005e73}
</style>
</div>
</section>
<section id="randomizing" class="slide level2">
<h2>Randomizing</h2>
<div>
<ul>
<li>Randomized treatment assignment:
<ul>
<li><span class="math inline">\(P(T_i = t) = \frac{1}{k}\)</span> where <span class="math inline">\(k\)</span> is the number of treatment groups / values</li>
</ul></li>
</ul>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition 3.1: “Covariate Balance”</strong></p>
</div>
<div class="callout-content">
<p>We have covariate balance if the distribution of covariates <span class="math inline">\(\mathbf{X}\)</span> is the same across treatment groups.</p>
<p>Formally:</p>
<p><span class="math inline">\(P(\mathbf{X} | T = t) \stackrel{d}{=} P(\mathbf{X} | T = t')\)</span> for all <span class="math inline">\(t, t'\)</span>.</p>
<p><span class="math inline">\(\mathbf{X} \perp\!\!\!\perp T\)</span>.</p>
</div>
</div>
</div>
</div>
<ul>
<li>Randomization implies covariate balance, across all covariates, even <strong>unobserved</strong> ones.</li>
</ul>
</section>
<section id="randomizing-association-becomes-causation" class="slide level2">
<h2>Randomizing: “Association becomes Causation”</h2>
<div>
<ul>
<li class="fragment"><code>Perspective 1a: "Graphical Models: Backdoor Adjustment"</code>
<ul>
<li class="fragment">Let <span class="math inline">\(\mathbf{X}\)</span> be a sufficient adjustment including all (un-) observed confounders, hence:
<ul>
<li class="fragment"><span class="math inline">\(P(Y | do(T = t)) = \sum_x P(Y | T = t, \mathbf{X} = \mathbf{x})P(\mathbf{X})\)</span></li>
</ul></li>
<li class="fragment">By multiplying by <span class="math inline">\(\frac{P(T = t | \mathbf{X} = \mathbf{x})}{P(T = t | \mathbf{X} = \mathbf{x})}\)</span>, we get the joint distribution in the numerator:
<ul>
<li class="fragment"><span class="math inline">\(P(Y | do(T = t)) = \sum_x \frac{P(Y | T= t, \mathbf{X} = \mathbf{x})P(T = t | \mathbf{X} = \mathbf{x})P(x)}{P(T = t | \mathbf{X} = \mathbf{x})} = \sum_x \frac{P(Y, T, \mathbf{X})}{P(T = t | \mathbf{X} = \mathbf{x})}\)</span></li>
</ul></li>
<li class="fragment">Now, we use the important result from randomization that <span class="math inline">\(\mathbf{X} \perp\!\!\!\perp T\)</span>:
<ul>
<li class="fragment"><span class="math inline">\(P(Y | do(T = t)) = \sum_x \frac{P(Y, T, \mathbf{X})}{P(T)}\)</span></li>
</ul></li>
<li class="fragment">By definition of conditional probabilities and marginalization we obtain q.e.d.:
<ul>
<li class="fragment"><span class="math inline">\(P(Y | do(T = t)) = \sum_x P(Y, \mathbf{X} | T = t) = P(Y | T = t)\)</span></li>
</ul></li>
</ul></li>
</ul>
</div>
</section>
<section id="randomizing-association-becomes-causation-1" class="slide level2">
<h2>Randomizing: “Association becomes Causation”</h2>
<div>
<ul>
<li><code>Perspective 1b: "Graphical Models: do-Operator"</code>
<ul>
<li>all backdoor paths are blocked</li>
<li>i.e.&nbsp;backdoor adjustment on empty set <span class="math inline">\(\emptyset\)</span> suffices</li>
<li><span class="math inline">\(P(Y | \text{do}(T = t)) = P(Y | T = t)\)</span></li>
</ul></li>
</ul>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="randomizing-association-becomes-causation-2" class="slide level2 smaller">
<h2>Randomizing: “Association becomes Causation”</h2>
<div>
<ul>
<li class="fragment"><code>Perspective 2: "Potential Outcomes" (Review &amp; Extension)"</code>
<ul>
<li class="fragment">Causation:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{cs} = \mathbb{E}[Y_i(1) - Y_i(0)]\)</span></li>
</ul></li>
<li class="fragment">Extend by probability <span class="math inline">\(p\)</span> of being in a subgroup:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{cs} = p\underbrace{(\mathbb{E}[Y_i(1) - Y_i(0)|T_i=1])}_{\text{ATT}} + (1-p)\underbrace{(\mathbb{E}[Y_i(1) - Y_i(0)|T_i=0])}_{\text{ATU}}\)</span></li>
<li class="fragment"><span class="math inline">\(ATE_{cs} = p\mathbb{E}[Y_i(1)|T_i=1] - p\mathbb{E}Y_i(0)|T_i=1] + (1-p)\mathbb{E}[Y_i(1)|T_i=0] - (1-p)\mathbb{E}Y_i(0)|T_i=0]\)</span></li>
<li class="fragment"><span class="math inline">\(ATE_{cs} = p\mu_{11} - p\mu_{01} + (1-p)\mu_{10} - (1-p)\mu_{00}\)</span></li>
</ul></li>
<li class="fragment">Association:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{as} = \mathbb{E}[Y_i|T_i=1] - \mathbb{E}[Y_i|T_i=0] = \mathbb{E}[Y_i(1)|T_i=1] - \mathbb{E}[Y_i(0)|T_i=0] = \mu_{11} - \mu_{00}\)</span></li>
</ul></li>
<li class="fragment">Add &amp; subtract ATE:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{as} = \color{#00C1D4}{ATE} + \mu_{11} - \mu_{00} - \color{#00C1D4}{p\mu_{11} + p\mu_{01} - (1-p)\mu_{10} + (1-p)\mu_{00}}\)</span></li>
</ul></li>
<li class="fragment">Add &amp; subtract <span class="math inline">\((1-p)\mu_{01}\)</span>:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{as} = ATE + \mu_{11} - \mu_{00} - p\mu_{11} + \underbrace{p\mu_{01} \color{#00C1D4}{+ (1-p)\mu_{01}}}_{=\mu_{01}} - (1-p)\mu_{10} + (1-p)\mu_{00} \color{#00C1D4}{- (1-p)\mu_{01}}\)</span></li>
</ul></li>
</ul></li>
</ul>
</div>
</section>
<section id="randomizing-association-becomes-causation-3" class="slide level2 smaller">
<h2>Randomizing: “Association becomes Causation”</h2>
<div>
<ul>
<li class="fragment"><code>Perspective 2: "Potential Outcomes" (Review &amp; Extension)"</code>
<ul>
<li class="fragment">Rearrange:
<ul>
<li class="fragment"><span class="math inline">\(ATE_{as} = ATE + \mu_{01} - \mu_{00} +  \underbrace{\mu_{11} - p\mu_{11}}_{=(1-p)\mu_{11}} - (1-p)\mu_{10} + (1-p)\mu_{00} - (1-p)\mu_{01}\)</span></li>
<li class="fragment"><span class="math inline">\(ATE_{as} = ATE + \mu_{01} - \mu_{00} +  (1-p)[\underbrace{\mu_{11} - \mu_{01}}_{\text{ATT}} - \underbrace{(\mu_{10} - \mu_{00})}_{\text{ATU}}]\)</span></li>
</ul></li>
<li class="fragment">Therefore:</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p><span class="math display">\[
\begin{align}
ATE_{as} &amp;= \underbrace{\mathbb{E}[Y_i(1) - Y_i(0)]}_{ATE_{cs}} \\ &amp;+ \underbrace{\mathbb{E}[Y_i(0)|T_i=1] - \mathbb{E}Y_i(0)|T_i=0]}_{\text{Confounding Bias}} \\ &amp;+ \underbrace{(1-\mathbb{E}[T_i])[\underbrace{\mathbb{E}[Y_i(1)|T_i=1] - \mathbb{E}[Y_i(0)|T_i=1]}_{\text{ATT}} - \underbrace{(\mathbb{E}[Y_i(1)|T_i=0] - \mathbb{E}[Y_i(0)|T_i=0])}_{\text{ATU}}]}_{\text{Heterogeneity Bias}}
\end{align}
\]</span></p>
</div>
</section>
<section id="randomizing-association-becomes-causation-4" class="slide level2 smaller">
<h2>Randomizing: “Association becomes Causation”</h2>
<div>
<ul>
<li class="fragment"><code>Perspective 2: "Potential Outcomes - Exchangeability"</code> implies <span class="math inline">\(\{Y(1), Y(0)\} \perp\!\!\!\perp T\)</span>.
<ul>
<li class="fragment">Exchangeability <strong>before</strong> treatment: <span class="math inline">\(\color{#00C1D4}{\mathbb{E}[Y_i(0)|T_i=0] = \mathbb{E}[Y_i(0)|T_i=1] = \mathbb{E}[Y_i(0)]}\)</span></li>
<li class="fragment">Exchangeability <strong>after</strong> treatment: <span class="math inline">\(\color{#FF7E15}{\mathbb{E}[Y_i(1)|T_i=1] = \mathbb{E}[Y_i(1)|T_i=0] = \mathbb{E}[Y_i(1)]}\)</span></li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p><span class="math display">\[
\begin{align}
ATE_{as} &amp;= \underbrace{\mathbb{E}[Y_i(1) - Y_i(0)]}_{ATE_{cs}} \\ &amp;+ \underbrace{\mathbb{E}[Y_i(0)|T_i=1] - \mathbb{E}Y_i(0)|T_i=0]}_{\color{#00C1D4}{\text{Confounding Bias = 0}}} \\ &amp;+ \underbrace{(1-\mathbb{E}[T_i])[\underbrace{\mathbb{E}[Y_i(1)|T_i=1] - \mathbb{E}[Y_i(0)|T_i=1]}_{\text{ATT}} - \underbrace{(\mathbb{E}[Y_i(1)|T_i=0] - \mathbb{E}[Y_i(0)|T_i=0])}_{\text{ATU}}]}_{\color{#FF7E15}{\text{Heterogeneity Bias = 0}}}
\end{align}
\]</span></p>
</div>
</section></section>
<section>
<section id="effect-identification" class="title-slide slide level1 center" data-stack-name="Identification">
<h1>Effect Identification</h1>

</section>
<section id="identification-of-ate-in-experiments" class="slide level2">
<h2>Identification of ATE in Experiments</h2>
<ul>
<li><code>Identification</code>:
<ul>
<li>expressing the inherently unobservable ATE in terms of observable quantities.</li>
<li>remove confounding and heterogeneity bias by randomization or addional assumptions. <br> <br></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Using randomization of <span class="math inline">\(T\)</span>, the <strong>mean comparison</strong> identifies the ATE:
<ul>
<li><span class="math inline">\(\tau_{\text{ATE}} = \mathbb{E}[Y_i(1) - Y_i(0)] = \mathbb{E}[Y_i|T_i=1] - \mathbb{E}[Y_i|T_i=0]\)</span></li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Mean comparison in a sample (rather than the population) is given by:
<ul>
<li><span class="math inline">\(\hat{\tau}_{\text{ATE}} = \frac{1}{\sum_i T_i} \sum_i T_i Y_i - \frac{1}{\sum_i (1 - T_i)} \sum_i (1 - T_i) Y_i\)</span></li>
</ul></li>
</ul>
</div>
</section>
<section id="identification-of-ate-in-experiments-example" class="slide level2">
<h2>Identification of ATE in Experiments: Example</h2>
<ul>
<li>Experiment conducted between November 1994 and February 1996:
<ul>
<li>Randomized access to <em>Job Corps</em>: education program financed by the U.S. Department of Labor that targets disadvantaged individuals aged 16 to 24.</li>
</ul></li>
</ul>
<div class="source">
<p>Source: Schochet, Burghardt, and Glazerman (2001); Schochet, Burghardt, and McConnell (2008).</p>
</div>
<ul>
<li>Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(causalweight)             <span class="co"># load causalweight package that inclkudes the data</span></span>
<span id="cb1-2"><a></a><span class="fu">data</span>(JC)                          <span class="co"># load JC data</span></span>
<span id="cb1-3"><a></a>T<span class="ot">=</span>JC<span class="sc">$</span>assignment                   <span class="co"># define treatment (assignment to JC)</span></span>
<span id="cb1-4"><a></a>Y<span class="ot">=</span>JC<span class="sc">$</span>earny4                       <span class="co"># define outcome (earnings in fourth year)</span></span>
<span id="cb1-5"><a></a><span class="fu">mean</span>((Y[T<span class="sc">==</span><span class="dv">0</span>]))                   <span class="co"># compute mean earnings in control group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 197.9258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">mean</span>(Y[T<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(Y[T<span class="sc">==</span><span class="dv">0</span>])       <span class="co"># compute the ATE </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.05513</code></pre>
</div>
</div>
</section>
<section id="identification-of-cate-in-experiments" class="slide level2">
<h2>Identification of CATE in Experiments</h2>
<ul>
<li>Also <code>conditional independence</code> holds in a properly randomized experiment:
<ul>
<li><span class="math inline">\(\{Y(1), Y(0)\} \perp\!\!\!\perp T | X\)</span> <br> <br></li>
</ul></li>
<li>Hence, the <code>Conditional Average Treatment Effect (CATE)</code> is also identified:
<ul>
<li><span class="math inline">\(\tau_{\text{CATE}}(x) = \mathbb{E}[Y_i(1) - Y_i(0)|X_i=x] = \mathbb{E}[Y_i|T_i=1, X_i=x] - \mathbb{E}[Y_i|T_i=0, X_i=x]\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Note that we condition on variables that are not affected by the treatment (e.g., pre-treatment covariates <span class="math inline">\(X\)</span>)
<ul>
<li>This is implied by writing <span class="math inline">\(X\)</span> and not <span class="math inline">\(X(T)\)</span>.</li>
</ul></li>
<li>We will learn about estimators of CATEs in an own session on <code>Effect Heterogeneity</code>.</li>
</ul>
</div>
</section>
<section id="effect-identification-by-linear-regression" class="slide level2 smaller">
<h2>Effect Identification by Linear Regression</h2>
<ul>
<li>ATE as mean comparison can also be expressed as a linear regression problem:</li>
<li>Start with the observed outcome for each i:
<ul>
<li><span class="math inline">\(Y_i = Y_i(1) * T_i + Y_i(0) * (1 - T_i)\)</span></li>
<li><span class="math inline">\(Y_i = Y_i(0) + (Y_i(1) - Y_i(0)) * T_i\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Take the conditional expectation of this expression given T in the population:
<ul>
<li><span class="math inline">\(\mathbb{E}[Y_i|T_i] = \mathbb{E}[Y_i(0) + (Y_i(1) - Y_i(0)) * T_i]\)</span></li>
<li><span class="math inline">\(\mathbb{E}[Y_i|T_i] = \mathbb{E}[Y_i(0)|T_i] + ( \mathbb{E}[Y_i(1)|T_i] - \mathbb{E}[Y_i(0)|T_i] ) * T_i\)</span></li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>With ignorability/ exchangeability we obtain:
<ul>
<li><span class="math inline">\(\mathbb{E}[Y_i|T_i] = \underbrace{\mathbb{E}[Y_i|T_i = 0]}_{\beta_0} + \underbrace{( \mathbb{E}[Y_i|T_i = 1] - \mathbb{E}[Y_i|T_i = 0] )}_{\beta_1} * T_i\)</span></li>
</ul></li>
</ul>
</div>
</section>
<section id="effect-identification-by-linear-regression-1" class="slide level2">
<h2>Effect Identification by Linear Regression</h2>
<ul>
<li><span class="math inline">\(\epsilon\)</span> is commonly referred to as error term or residual and formally defined as follows:
<ul>
<li><span class="math inline">\(\epsilon_i = Y_i - \underbrace{(\beta_0 + \beta_1 * T_i)}_{\mathbb{E}[Y_i|T_i]}\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-6-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="estimation-by-linear-regression" class="slide level2 smaller">
<h2>Estimation By Linear Regression</h2>
<ul>
<li>We obtain the ATE based on linear regression by minimizing the sum of squared residuals in the sample:
<ul>
<li><span class="math inline">\(\hat{\beta_0}, \hat{\beta_1} = \arg \min_{\beta_0^*, \beta_1^*} \sum_{i=1}^{n} \underbrace{(Y_i - \beta_0^* - \beta_1^* T_i)^2}_{\epsilon_i}\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Solving this minimization problem yields the following parameter estimates:
<ul>
<li><span class="math inline">\(\hat{\beta_1} = \frac{\text{Cov}(Y_i, T_i)}{\text{Var}(T_i)}, \text{ where}\)</span></li>
<li><span class="math inline">\(\text{Cov}(Y_i, T_i) = \frac{1}{n - 1} \sum_{i=1}^{n} \left(Y_i - \frac{1}{n}\sum_{i=1}^{n}Y_i\right)\left(T_i - \frac{1}{n}\sum_{i=1}^{n}T_i\right), \text{and}\)</span></li>
<li><span class="math inline">\(\text{Var}(T_i) = \frac{1}{n - 1} \sum_{i=1}^{n} \left(T_i - \frac{1}{n}\sum_{i=1}^{n}T_i\right)^2\)</span></li>
<li><span class="math inline">\(\hat{\beta_0} = -\frac{1}{n}\sum_{i=1}^{n} Y_i - \hat{\beta_1}\frac{1}{n}\sum_{i=1}^{n} T_i\)</span></li>
</ul></li>
</ul>
</div>
</section></section>
<section>
<section id="statistical-inference" class="title-slide slide level1 center" data-stack-name="Inference">
<h1>Statistical Inference</h1>

</section>
<section id="properties-of-regression-estimates" class="slide level2 smaller">
<h2>Properties of Regression Estimates</h2>
<ul>
<li><code>Unbiased</code>: on average, equal to the true parameter values across different samples:
<ul>
<li><span class="math inline">\(\mathbb{E}[\hat{\beta_1}] = \beta_1, \text{ and}\)</span></li>
<li><span class="math inline">\(\mathbb{E}[\hat{\beta_0}] = \beta_0\)</span></li>
</ul></li>
<li><code>Consistent</code>: converges in probability to the true parameter values as sample size increases:
<ul>
<li><span class="math inline">\(\hat{\beta_1} \xrightarrow{p} \beta_1, \text{ and}\)</span></li>
<li><span class="math inline">\(\hat{\beta_0} \xrightarrow{p} \beta_0\)</span></li>
</ul></li>
<li><code>Asymptotically normally distributed</code>: follows a normal distribution across suffciently large samples:
<ul>
<li><span class="math inline">\(\sqrt{n}(\hat{\beta_1} - \beta_1) \xrightarrow{d} \mathcal{N}(0, \sigma^2_{\beta_1}), \text{ and}\)</span></li>
<li><span class="math inline">\(\sqrt{n}(\hat{\beta_0} - \beta_0) \xrightarrow{d} \mathcal{N}(0, \sigma^2_{\beta_0})\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="source">
<p>Note: We skip the proofs here. They can be found in any introductory econometrics textbook such as Wooldridge (2010): Econometric Analysis of Cross Section and Panel Data (MIT Press) .</p>
</div>
</div>
</section>
<section id="inference-goals" class="slide level2">
<h2>Inference Goals</h2>
<ul>
<li>Quantifying the precision or uncertainty of the parameter estimates:
<ul>
<li>With which error probability can we rule out that the ATE is equal to zero (or some other value we are interested in) in the population, given the ATE estimate in our sample?</li>
<li>What is the range or interval of values that likely includes the ATE in the population, given the finndings in our sample?</li>
<li><code>Standard errors (SE)</code>: measure the variability of the estimated ATE across different samples</li>
<li><code>Hypothesis tests</code>: assess whether the estimated ATE is statistically different from zero</li>
<li><code>Confidence intervals (CI)</code>: provide a range of plausible values for the true ATE</li>
</ul></li>
</ul>
</section>
<section id="standard-errors" class="slide level2 smaller">
<h2>Standard Errors</h2>
<ul>
<li>Asymptotic variance of the ATE unknown as it relies on population parameters:
<ul>
<li><span class="math inline">\(\text{Var}(\hat{\beta_1}) = \frac{\mathbb{E}[\epsilon^2 \cdot (T_i - \mathbb{E}[T_i])^2]}{n \cdot (\text{Var}(T_i))^2}\)</span></li>
</ul></li>
<li>Start with a variance estimator of ATE in the sample:
<ul>
<li><span class="math inline">\(\widehat{\text{Var}}(\hat{\beta_1}) = \frac{\frac{1}{n} \sum_{i=1}^{n} \hat{\epsilon}_i^2 \cdot \left( T_i - \frac{1}{n} \sum_{i=1}^{n} T_i \right)^2}{n \cdot \left( \widehat{\text{Var}}(T_i) \right)^2}\)</span> with <span class="math inline">\(\hat{\epsilon}_i = Y_i - \hat{\beta_0} - \hat{\beta_1} T_i\)</span></li>
</ul></li>
<li>Standard error of the ATE estimate:
<ul>
<li><span class="math inline">\(se(\hat{\beta_1}) = \sqrt{\widehat{\text{Var}}(\hat{\beta_1})}\)</span></li>
</ul></li>
<li>Obtain the standard <em>normal</em> vs <em>t</em> distribution:
<ul>
<li><span class="math inline">\(z_1 = \frac{\hat{\beta_1} - \beta_1}{sd(\hat{\beta_1})} \xrightarrow{d} \mathcal{N}(0, 1)\)</span> vs <span class="math inline">\(t_1 = \frac{\hat{\beta_1} - \beta_1}{se(\hat{\beta_1})} \sim t_{n-2}\)</span></li>
</ul></li>
</ul>
</section>
<section id="t-distribution" class="slide level2 scrollable">
<h2>t-Distribution</h2>
<ul>
<li>The t-distribution is a family of distributions indexed by the degrees of freedom (df):
<ul>
<li><span class="math inline">\(t_{df} = \frac{Z}{\sqrt{V/df}}\)</span>, where <span class="math inline">\(Z \sim \mathcal{N}(0, 1)\)</span> and <span class="math inline">\(V \sim \chi^2(df)\)</span></li>
</ul></li>
<li>How likely is a specific t-value computed from a sample if the true ATE in the population is zero?</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-7-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="hypothesis-testing" class="slide level2 smaller">
<h2>Hypothesis Testing</h2>
<ul>
<li><strong>Step 1:</strong> Define the null hypothesis <span class="math inline">\(H_0\)</span> and alternative hypothesis <span class="math inline">\(H_1\)</span>: <br>
<ul>
<li>Two-sided, undirected test:
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\beta_1 = 0\)</span> and <span class="math inline">\(H_1\)</span>: <span class="math inline">\(\beta_1 \neq 0\)</span></li>
</ul></li>
<li>One-sided, directed test:
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\beta_1 \leq 0\)</span> and <span class="math inline">\(H_1\)</span>: <span class="math inline">\(\beta_1 &gt; 0\)</span></li>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\beta_1 \geq 0\)</span> and <span class="math inline">\(H_1\)</span>: <span class="math inline">\(\beta_1 &lt; 0\)</span></li>
</ul></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li><strong>Step 2:</strong> Set the significance level <span class="math inline">\(\alpha\)</span>:
<ul>
<li>maximally accepted type I error probability of incorrectly rejecting H0 and accepting H1</li>
<li><span class="math inline">\(\alpha = 0.05\)</span> implies that the error probability must not exceed 5%</li>
<li>other conventional levels of significance are 0.01 (1%) or 0.1 (10%)</li>
</ul></li>
</ul>
</div>
</section>
<section id="hypothesis-testing-1" class="slide level2 smaller">
<h2>Hypothesis Testing</h2>
<ul>
<li><strong>Step 3:</strong> Compute the critical value <span class="math inline">\(c\)</span>:
<ul>
<li>Quantile in the t-distribution that corresponds to <span class="math inline">\(\alpha\)</span>, given <span class="math inline">\(H_0\)</span> is true</li>
<li>Two-sided, undirected test and <span class="math inline">\(\alpha = 0.05\)</span>: <span class="math inline">\(c = t_{\alpha/2 = 0.025, 1000-2} = 1.96\)</span></li>
<li>One-sided, directed test and <span class="math inline">\(\alpha = 0.05\)</span>: <span class="math inline">\(c = t_{\alpha = 0.05, 1000-2} = 1.65\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li><strong>Step 4:</strong> Compute the t-statistic and p-value:
<ul>
<li><code>Test statistic</code>: <span class="math inline">\(t_1 = \frac{\hat{\beta_1} - 0}{se(\hat{\beta_1})}\)</span></li>
<li><code>p-value</code>: probability of observing a test statistic as extreme as <span class="math inline">\(t_1\)</span> under the null hypothesis
<ul>
<li>Two-sided, undirected test: <span class="math inline">\(p = Pr(|A| \geq |t_1|)\)</span></li>
<li>One-sided, directed test: <span class="math inline">\(p = Pr(A \geq t_1)\)</span> or <span class="math inline">\(p = Pr(A \leq t_1)\)</span></li>
</ul></li>
<li>In a two-sided, undirected test, verify that:
<ul>
<li><span class="math inline">\(|t_1| &gt; c\)</span>; <span class="math inline">\(p &lt; \alpha/2\)</span></li>
</ul></li>
<li>In a one-sided, directed test, verify that:
<ul>
<li><span class="math inline">\(t_1 &gt; c\)</span> or <span class="math inline">\(t_1 &lt; -c\)</span>; <span class="math inline">\(p &lt; \alpha\)</span></li>
</ul></li>
</ul></li>
</ul>
</div>
</section>
<section id="confidence-intervals" class="slide level2 smaller">
<h2>Confidence Intervals</h2>
<ul>
<li><p>Range of ATE values such that the true ATE <span class="math inline">\(\beta_1\)</span> is included with probability <span class="math inline">\(1-\alpha\)</span>, based on the estimated ATE <span class="math inline">\(\hat{\beta_1}\)</span> and the standard error <span class="math inline">\(se(\hat{\beta_1})\)</span> obtained in the sample</p></li>
<li><p>Constructed in such a way that in the (hypothetical) case that we could draw many samples and construct confidence intervals in all those samples, a share of <span class="math inline">\(1-\alpha\)</span> confidence intervals would include the true <span class="math inline">\(\beta_1\)</span> </p></li>
<li><p><code>Two-sided confidence interval</code>:</p>
<ul>
<li><span class="math inline">\(CI = \hat{\beta_1} \pm c \cdot se(\hat{\beta_1})\)</span></li>
<li>e.g.&nbsp;<span class="math inline">\(CI = 0.3 \pm 1.96 \cdot 0.05 = [0.202, 0.398]\)</span></li>
</ul></li>
<li><p><code>One-sided confidence interval</code>:</p>
<ul>
<li><span class="math inline">\(CI = \hat{\beta_1} + c \cdot se(\hat{\beta_1})\)</span></li>
<li>e.g.&nbsp;<span class="math inline">\(CI = 0.3 - 1.65 \cdot 0.05 = [0.2175, \infty]\)</span></li>
</ul></li>
</ul>
</section>
<section id="r-squared" class="slide level2 smaller">
<h2>R-squared</h2>
<ul>
<li><code>In general</code>: percentage of variance in the outcome <span class="math inline">\(Y\)</span> that is explained by all variables in the model:
<ul>
<li><span class="math inline">\(R^2 = 1 - \frac{SSR}{SST}\)</span></li>
<li><span class="math inline">\(SSR = \sum_{i=1}^{n} (Y_i - \hat{Y_i})^2\)</span></li>
<li><span class="math inline">\(SST = \sum_{i=1}^{n} (Y_i - \bar{Y})^2\)</span></li>
</ul></li>
<li><code>Specific case</code>: just one binary treatment variable <span class="math inline">\(T\)</span> in the model:
<ul>
<li><span class="math inline">\(R^2 = r^2\)</span> where <span class="math inline">\(r\)</span> is the correlation between <span class="math inline">\(Y\)</span> and <span class="math inline">\(T\)</span></li>
<li><span class="math inline">\(R^2 = \left( \frac{\sum_{i=1}^{n} (Y_i - \bar{Y})(T_i - \bar{T})}{\sqrt{\sum_{i=1}^{n} (Y_i - \bar{Y})^2} \cdot \sqrt{\sum_{i=1}^{n}(T_i - \bar{T})^2}} \right)^2\)</span></li>
</ul></li>
</ul>
</section>
<section id="ate-in-experiments-regression-example" class="slide level2 smaller">
<h2>ATE in Experiments: Regression Example</h2>
<ul>
<li>Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">library</span>(causalweight)             <span class="co"># load causalweight package </span></span>
<span id="cb5-2"><a></a><span class="fu">library</span>(sandwich)                 <span class="co"># load sandwich package</span></span>
<span id="cb5-3"><a></a><span class="fu">library</span>(modelsummary)             <span class="co"># load modelsummary package)</span></span>
<span id="cb5-4"><a></a><span class="fu">data</span>(JC)                          <span class="co"># load JC data</span></span>
<span id="cb5-5"><a></a>T<span class="ot">=</span>JC<span class="sc">$</span>assignment                   <span class="co"># define treatment (assignment to JC)</span></span>
<span id="cb5-6"><a></a>Y<span class="ot">=</span>JC<span class="sc">$</span>earny4                       <span class="co"># define outcome (earnings in fourth year)</span></span>
<span id="cb5-7"><a></a>ols<span class="ot">=</span><span class="fu">lm</span>(Y<span class="sc">~</span>T)                       <span class="co"># run OLS regression</span></span>
<span id="cb5-8"><a></a><span class="co"># display results</span></span>
<span id="cb5-9"><a></a><span class="fu">modelsummary</span>(ols, <span class="at">vcov =</span> sandwich<span class="sc">::</span>vcovHC, </span>
<span id="cb5-10"><a></a>             <span class="at">estimate =</span> <span class="st">"est = {estimate} (se = {std.error}, t = {statistic}){stars}"</span>, </span>
<span id="cb5-11"><a></a>             <span class="at">statistic =</span> <span class="st">"p = {p.value}, CI = [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb5-12"><a></a>             <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"r.squared"</span>))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_qfznkjawdrwszvl64uvh</title>
    <style>
.table td.tinytable_css_ct1r2wsj896rho98ie2l, .table th.tinytable_css_ct1r2wsj896rho98ie2l {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_j8q2uh9wj5s3q8mpb9mq, .table th.tinytable_css_j8q2uh9wj5s3q8mpb9mq {    text-align: left; }
.table td.tinytable_css_xforemi9c0ap9eg7z59q, .table th.tinytable_css_xforemi9c0ap9eg7z59q {    text-align: center; }
.table td.tinytable_css_jonff2vk29k6isnstyxk, .table th.tinytable_css_jonff2vk29k6isnstyxk {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_qfznkjawdrwszvl64uvh" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)</td>
                  <td>est = 197.926 (se = 3.073, t = 64.416)***</td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = &lt;0.001, CI = [191.903, 203.949]      </td>
                </tr>
                <tr>
                  <td>T          </td>
                  <td>est = 16.055 (se = 4.074, t = 3.941)***  </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = &lt;0.001, CI = [8.069, 24.041]         </td>
                </tr>
                <tr>
                  <td>R2         </td>
                  <td>0.002                                    </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_rhxzje6qt4ljar8mpair(i, j, css_id) {
        var table = document.getElementById("tinytable_qfznkjawdrwszvl64uvh");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_qfznkjawdrwszvl64uvh');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_rhxzje6qt4ljar8mpair(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_qfznkjawdrwszvl64uvh");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(0, 0, 'tinytable_css_ct1r2wsj896rho98ie2l') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(0, 1, 'tinytable_css_ct1r2wsj896rho98ie2l') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(0, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(1, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(2, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(3, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(4, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(5, 0, 'tinytable_css_j8q2uh9wj5s3q8mpb9mq') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(0, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(1, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(2, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(3, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(4, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(5, 1, 'tinytable_css_xforemi9c0ap9eg7z59q') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(4, 0, 'tinytable_css_jonff2vk29k6isnstyxk') })
window.addEventListener('load', function () { styleCell_tinytable_rhxzje6qt4ljar8mpair(4, 1, 'tinytable_css_jonff2vk29k6isnstyxk') })
    </script>

  


</div>
</div>
</section>
<section id="bootstrapping" class="slide level2 smaller">
<h2>Bootstrapping</h2>
<ul>
<li><code>Bootstrap sampling</code>: <span class="math inline">\(B\)</span> randomly drawn samples of the same size as the original sample, with replacement</li>
<li>Calculate the ATE in each bootstrap sample via regression</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="_images/3/bootstrap.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
<div class="source">
<p>Source: Huber, Martin (2023). Causal analysis: Impact evaluation and Causal Machine Learning with applications in R. MIT Press, 2023.</p>
</div>
<ul>
<li>Calculate the standard error by: <span class="math inline">\(se(\hat{\beta_1}) = \sqrt{\frac{1}{B - 1} \sum_{b=1}^{B} \left(\hat{\beta_1^b} - \frac{1}{B}\sum_{b=1}^{B}\hat{\beta_1^b}\right)^2}\)</span></li>
</ul>
</section>
<section id="ate-in-experiments-bootstrapping-example" class="slide level2 smaller">
<h2>ATE in Experiments: Bootstrapping Example</h2>
<ul>
<li>Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">library</span>(causalweight)             <span class="co"># load causalweight package </span></span>
<span id="cb6-2"><a></a><span class="fu">library</span>(boot)                     <span class="co"># load boot package</span></span>
<span id="cb6-3"><a></a><span class="fu">data</span>(JC)                          <span class="co"># load JC data</span></span>
<span id="cb6-4"><a></a>T<span class="ot">=</span>JC<span class="sc">$</span>assignment                   <span class="co"># define treatment (assignment to JC)</span></span>
<span id="cb6-5"><a></a>Y<span class="ot">=</span>JC<span class="sc">$</span>earny4                       <span class="co"># define outcome (earnings in fourth year)</span></span>
<span id="cb6-6"><a></a>bootdata<span class="ot">=</span><span class="fu">data.frame</span>(Y,T)          <span class="co"># data frame with Y,D for bootstrap procedure</span></span>
<span id="cb6-7"><a></a>bs<span class="ot">=</span><span class="cf">function</span>(data, indices) {      <span class="co"># defines function bs for bootstrapping</span></span>
<span id="cb6-8"><a></a>  dat<span class="ot">=</span>data[indices,]              <span class="co"># creates bootstrap sample according to indices </span></span>
<span id="cb6-9"><a></a>  coefficients<span class="ot">=</span><span class="fu">lm</span>(dat)<span class="sc">$</span>coef       <span class="co"># estimates coefficients in bootstrap sample  </span></span>
<span id="cb6-10"><a></a>  <span class="fu">return</span>(coefficients)            <span class="co"># returns coefficients</span></span>
<span id="cb6-11"><a></a>}                                 <span class="co"># closes the function bs  </span></span>
<span id="cb6-12"><a></a><span class="fu">set.seed</span>(<span class="dv">1</span>)                       <span class="co"># set seed</span></span>
<span id="cb6-13"><a></a>results <span class="ot">=</span> <span class="fu">boot</span>(<span class="at">data=</span>bootdata, <span class="at">statistic=</span>bs, <span class="at">R=</span><span class="dv">1999</span>) <span class="co"># 1999 bootstrap estimations </span></span>
<span id="cb6-14"><a></a>results                           <span class="co"># displays the results </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ORDINARY NONPARAMETRIC BOOTSTRAP


Call:
boot(data = bootdata, statistic = bs, R = 1999)


Bootstrap Statistics :
     original      bias    std. error
t1* 197.92584  0.02480312    3.013465
t2*  16.05513 -0.02075945    3.954810</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>tstat<span class="ot">=</span>results<span class="sc">$</span>t0[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">2</span>])  <span class="co"># compute the t-statistic</span></span>
<span id="cb8-2"><a></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(tstat))                   <span class="co"># compute the p-value asssuming standard normal distribution</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           T 
4.914718e-05 </code></pre>
</div>
</div>
</section></section>
<section>
<section id="extensions" class="title-slide slide level1 center" data-stack-name="Extensions">
<h1>Extensions</h1>

</section>
<section id="multivalued-treatments" class="slide level2 smaller">
<h2>Multivalued Treatments</h2>
<ul>
<li>Treatment can take on discrete values, which can be ordered or unordered:
<ul>
<li><span class="math inline">\(T = 0, 1, 2, ...\)</span>: 0 = 0 weeks of training, 1 = 1 week of training, 2 = 2 weeks of training, …</li>
<li><span class="math inline">\(T = A, B, C, ...\)</span>: A = no training, B = IT training, C = management training, …</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Independence assumption can be adapted to hold for any treatment value:
<ul>
<li><span class="math inline">\(Y_i(0), Y_i(1), Y_i(2), ..., Y_i(J) \perp\!\!\!\perp T_i\)</span></li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Analyze the ATEs of each non-zero treatment in a linear regression by including binary <strong>dummy</strong> variables for each:
<ul>
<li><span class="math inline">\(\mathbb{E}[Y_i | T_i] = \underbrace{\beta_0}_{E[Y_i | T_i=0]} + \underbrace{\beta_1}_{E[Y_i | T_i=1] - E[Y_i | T_i=0]} T_{i1} + \underbrace{\beta_2}_{E[Y_i |  T_i=2] - E[Y_i |  T_i=0]} T_{i2} + \dots + \underbrace{\beta_J}_{E[Y_i | T_i=J] - E[Y_i | T_i=0]} T_{iJ}\)</span></li>
<li><span class="math inline">\(T_{ij} = 1\)</span> if <span class="math inline">\(T_i = j\)</span> and <span class="math inline">\(T_{ij} = 0\)</span> otherwise</li>
</ul></li>
</ul>
</div>
</section>
<section id="multivalued-treatments-example" class="slide level2 smaller">
<h2>Multivalued Treatments: Example</h2>
<ul>
<li>Assess wage expectations (measure in brackets of 500 EUR) of 804 university students based on two-level treatment:
<ul>
<li><code>treatmentinformation</code>: Graph with information on monthly gross private sector earnings shown.</li>
<li><code>treatmentorder</code>: Reversed order of questions about professional and personal preferences (“framing”).</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">library</span>(causalweight)             <span class="co"># load causalweight package </span></span>
<span id="cb10-2"><a></a><span class="fu">data</span>(wexpect)                     <span class="co"># load wexpect data</span></span>
<span id="cb10-3"><a></a>T1<span class="ot">=</span>wexpect<span class="sc">$</span>treatmentinformation   <span class="co"># define first treatment (wage information)</span></span>
<span id="cb10-4"><a></a>T2<span class="ot">=</span>wexpect<span class="sc">$</span>treatmentorder         <span class="co"># define second treatment (order of questions)</span></span>
<span id="cb10-5"><a></a>Y<span class="ot">=</span>wexpect<span class="sc">$</span>wexpect2                <span class="co"># define outcome (wage expectations) </span></span>
<span id="cb10-6"><a></a>ols<span class="ot">=</span><span class="fu">lm</span>(Y<span class="sc">~</span>T1<span class="sc">+</span>T2)                   <span class="co"># run OLS regression</span></span>
<span id="cb10-7"><a></a><span class="co"># display results</span></span>
<span id="cb10-8"><a></a><span class="fu">modelsummary</span>(ols, <span class="at">vcov =</span> sandwich<span class="sc">::</span>vcovHC, <span class="at">estimate =</span> <span class="st">"est = {estimate} (se = {std.error}, t = {statistic}){stars}"</span>, <span class="at">statistic =</span> <span class="st">"p = {p.value}, CI = [{conf.low}, {conf.high}]"</span>, <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"r.squared"</span>))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_h4kgvpyee44b91na4vbb</title>
    <style>
.table td.tinytable_css_os0odwqh5iww7jesqcjv, .table th.tinytable_css_os0odwqh5iww7jesqcjv {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_wn11e72ldz94gv2dylug, .table th.tinytable_css_wn11e72ldz94gv2dylug {    text-align: left; }
.table td.tinytable_css_zg734ekshke42zws71jp, .table th.tinytable_css_zg734ekshke42zws71jp {    text-align: center; }
.table td.tinytable_css_cbawm3761p9y8sm3x0ce, .table th.tinytable_css_cbawm3761p9y8sm3x0ce {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_h4kgvpyee44b91na4vbb" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)</td>
                  <td>est = 9.408 (se = 0.159, t = 59.268)***</td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = &lt;0.001, CI = [9.096, 9.719]        </td>
                </tr>
                <tr>
                  <td>T1         </td>
                  <td>est = 0.345 (se = 0.243, t = 1.421)    </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = 0.156, CI = [-0.132, 0.822]        </td>
                </tr>
                <tr>
                  <td>T2         </td>
                  <td>est = -0.173 (se = 0.234, t = -0.741)  </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = 0.459, CI = [-0.633, 0.286]        </td>
                </tr>
                <tr>
                  <td>R2         </td>
                  <td>0.006                                  </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_q2fm8wfrya6so0qckfcs(i, j, css_id) {
        var table = document.getElementById("tinytable_h4kgvpyee44b91na4vbb");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_h4kgvpyee44b91na4vbb');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_q2fm8wfrya6so0qckfcs(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_h4kgvpyee44b91na4vbb");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 0, 'tinytable_css_os0odwqh5iww7jesqcjv') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 1, 'tinytable_css_os0odwqh5iww7jesqcjv') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(1, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(2, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(3, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(4, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(5, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(7, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(1, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(2, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(3, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(4, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(5, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(7, 1, 'tinytable_css_zg734ekshke42zws71jp') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 0, 'tinytable_css_cbawm3761p9y8sm3x0ce') })
window.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 1, 'tinytable_css_cbawm3761p9y8sm3x0ce') })
    </script>

  


</div>
</div>
</section>
<section id="continuous-treatments" class="slide level2 smaller">
<h2>Continuous Treatments</h2>
<ul>
<li>Treatment can take on many (even infinitely) different values that respect cardinality.
<ul>
<li>e.g.&nbsp;marketing expenditure in EUR, years of education, …</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Independence assumption to hold for any values of the continuous treatment:
<ul>
<li><span class="math inline">\(Y_i(t) \perp\!\!\!\perp T_i\)</span></li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><code>Discretize</code> a continuous treatment by generating binary indicators for (very small) brackets of values:
<ul>
<li>e.g.&nbsp;<span class="math inline">\(T_{i0} = 0\)</span> if <span class="math inline">\(T_i \leq 100\)</span>, <span class="math inline">\(T_{i1} = 1\)</span> if <span class="math inline">\(100 &lt; T_i \leq 200\)</span>, …</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Include <span class="math inline">\(T_i\)</span> as a continuous variable in the regression model:
<ul>
<li><span class="math inline">\(\mathbb{E}[Y_i | T_i] = \beta_0 + \beta_1 T_i\)</span></li>
<li>First derivative of the expected value of <span class="math inline">\(Y_i\)</span> with respect to <span class="math inline">\(T_i\)</span> reflects the <strong>marginal effect</strong> of a one-unit increase in <span class="math inline">\(T_i\)</span> on <span class="math inline">\(Y_i\)</span>:</li>
<li><span class="math inline">\(ATE = \frac{\partial \mathbb{E}[Y_i | T_i]}{\partial T_i} = \frac{\partial \mathbb{E}[Y_i(T_i)]}{\partial T_i} = \frac{\partial \mathbb{E}[Y_i]}{\partial T_i} = \beta_1\)</span></li>
</ul></li>
</ul>
</div>
</section>
<section id="continuous-treatments-non-linearity" class="slide level2 smaller">
<h2>Continuous Treatments: Non-Linearity</h2>
<ul>
<li>Linearity: <span class="math inline">\(\frac{\partial \mathbb{E}[Y_i(T_i = t')]}{\partial T_i} = \frac{\partial \mathbb{E}[Y_i(T_i = t)]}{\partial T_i}\)</span> for any <span class="math inline">\(t' \neq t\)</span> which <span class="math inline">\(T_i\)</span> can take on</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-12-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-13-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Quadratic term in the regression model:
<ul>
<li><span class="math inline">\(\mathbb{E}[Y_i | T_i] = \beta_0 + \beta_1 T_i + \beta_2 T_i^2\)</span></li>
<li><span class="math inline">\(ATE = \frac{\partial \mathbb{E}[Y_i | T_i]}{\partial T_i} = \beta_1 + 2 \beta_2 T_i\)</span></li>
</ul></li>
<li>Increase model flexibility with higher-order terms (e.g.&nbsp;cubic, …) or non-parametric splines or kernel regression</li>
</ul>
</div>
</section>
<section id="continuous-treatments-example" class="slide level2 smaller">
<h2>Continuous Treatments: Example</h2>
<ul>
<li>Assess sales as a function of advertising spending in newspapers on a data set with 200 observations:</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">library</span>(datarium)                 <span class="co"># load datarium package</span></span>
<span id="cb11-2"><a></a><span class="fu">library</span>(np)                       <span class="co"># load np package</span></span>
<span id="cb11-3"><a></a><span class="fu">data</span>(marketing)                   <span class="co"># load marketing data</span></span>
<span id="cb11-4"><a></a>T<span class="ot">=</span>marketing<span class="sc">$</span>newspaper             <span class="co"># define treatment (newspaper advertising)</span></span>
<span id="cb11-5"><a></a>Y<span class="ot">=</span>marketing<span class="sc">$</span>sales                 <span class="co"># define outcome (sales)</span></span>
<span id="cb11-6"><a></a>results <span class="ot">=</span> <span class="fu">npregbw</span>(Y<span class="sc">~</span>T)             <span class="co"># kernel regression</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Multistart 1 of 1 |
Multistart 1 of 1 |
Multistart 1 of 1 |
Multistart 1 of 1 /
Multistart 1 of 1 |
Multistart 1 of 1 |
                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">plot</span>(results, <span class="at">plot.errors.method=</span><span class="st">"asymptotic"</span>) <span class="co"># plot regression function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">library</span>(datarium)                 <span class="co"># load datarium package</span></span>
<span id="cb14-2"><a></a><span class="fu">library</span>(np)                       <span class="co"># load np package</span></span>
<span id="cb14-3"><a></a><span class="fu">data</span>(marketing)                   <span class="co"># load marketing data</span></span>
<span id="cb14-4"><a></a>T<span class="ot">=</span>marketing<span class="sc">$</span>newspaper             <span class="co"># define treatment (newspaper advertising)</span></span>
<span id="cb14-5"><a></a>Y<span class="ot">=</span>marketing<span class="sc">$</span>sales                 <span class="co"># define outcome (sales)</span></span>
<span id="cb14-6"><a></a>results <span class="ot">=</span> <span class="fu">npregbw</span>(Y<span class="sc">~</span>T)             <span class="co"># kernel regression</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Multistart 1 of 1 |
Multistart 1 of 1 |
Multistart 1 of 1 |
Multistart 1 of 1 /
Multistart 1 of 1 |
Multistart 1 of 1 |
                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">plot</span>(results, <span class="at">gradients=</span><span class="cn">TRUE</span>, <span class="at">plot.errors.method=</span><span class="st">"asymptotic"</span>) <span class="co"># plot effects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-15-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="including-covariates" class="slide level2">
<h2>Including Covariates</h2>
<ul>
<li><p>Given successful randomization, there is no need to include covariates in the estimation of the ATE.</p></li>
<li><p>However, including covariates can reduce variance and thus uncertainty in the estimation of the ATE.</p></li>
<li><p><span class="math inline">\(Y_i = \underbrace{\hat{\beta_0} + \hat{\beta}_1 T_i + \hat{\beta}_{X_1} X_{i1} + \dots + \hat{\beta}_{X_K} X_{iK}}_{\hat{E}[Y_i | T_i, X_i]} + \hat{\epsilon}_i\)</span></p></li>
<li><p><span class="math inline">\(R^2 = \frac{\text{Var}(\hat{E}[Y_i | T_i, X_i])}{\text{Var}(Y_i)}\)</span> gets larger while <span class="math inline">\(\frac{\text{Var}(\hat{\epsilon}_i)}{\text{Var}(Y_i)}\)</span> gets smaller with the inclusion of covariates.</p></li>
<li><p>This further reduces the standard error of the ATE estimate <span class="math inline">\(se(\hat{\beta}_1)\)</span>.</p></li>
</ul>
</section>
<section id="including-covariates-1" class="slide level2 smaller">
<h2>Including Covariates</h2>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li><code>Pre-treatment covariates</code></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-16-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:20%;">

</div><div class="column" style="width:30%;">
<ul>
<li><code>Post-treatment covariates</code></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="03_exper_files/figure-revealjs/unnamed-chunk-17-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:20%;">

</div>
</div>
<div class="fragment">
<ul>
<li>Controlling for post-treatment covariates is a <strong>bad idea</strong>:
<ul>
<li><ol type="1">
<li>they condition away part of the treatment effect</li>
</ol></li>
<li><ol start="2" type="1">
<li>they introduce association between <span class="math inline">\(T\)</span> and <span class="math inline">\(U\)</span> as colliders and thus harm randomization.</li>
</ol></li>
</ul></li>
</ul>
</div>
</section>
<section id="including-covariates-example" class="slide level2 smaller">
<h2>Including Covariates: Example</h2>
<ul>
<li>Assess the awareness about environmental issues of 522 university students after randomly receiving or not receiving a leaflet with information about the environmental and social implications of coffee production.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">library</span>(causalweight)             <span class="co"># load causalweight package </span></span>
<span id="cb17-2"><a></a><span class="fu">library</span>(sandwich)                 <span class="co"># load sandwich package</span></span>
<span id="cb17-3"><a></a><span class="fu">data</span>(coffeeleaflet)               <span class="co"># load coffeeleaflet data</span></span>
<span id="cb17-4"><a></a><span class="fu">attach</span>(coffeeleaflet)             <span class="co"># store all variables in own objects</span></span>
<span id="cb17-5"><a></a>T<span class="ot">=</span><span class="fu">c</span>(coffeeleaflet<span class="sc">$</span>treatment)         <span class="co"># define treatment (leaflet)</span></span>
<span id="cb17-6"><a></a>Y<span class="ot">=</span><span class="fu">c</span>(coffeeleaflet<span class="sc">$</span>awarewaste)                      <span class="co"># define outcome (aware of waste production)</span></span>
<span id="cb17-7"><a></a>X<span class="ot">=</span><span class="fu">cbind</span>(coffeeleaflet<span class="sc">$</span>mumedu,coffeeleaflet<span class="sc">$</span>sex)               <span class="co"># define covariates (grade, gender, age)</span></span>
<span id="cb17-8"><a></a>ols<span class="ot">=</span><span class="fu">lm</span>(Y<span class="sc">~</span>T<span class="sc">+</span>X)                     <span class="co"># run OLS regression</span></span>
<span id="cb17-9"><a></a><span class="fu">modelsummary</span>(ols, <span class="at">vcov =</span> sandwich<span class="sc">::</span>vcovHC, <span class="at">estimate =</span> <span class="st">"est = {estimate} (se = {std.error}, t = {statistic}){stars}"</span>, <span class="at">statistic =</span> <span class="st">"p = {p.value}, CI = [{conf.low}, {conf.high}]"</span>, <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"r.squared"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_000epqhktawt9i57fg7a</title>
    <style>
.table td.tinytable_css_euimo2rfkquw8qy4ra7k, .table th.tinytable_css_euimo2rfkquw8qy4ra7k {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_pjjbjry2byujm9pu0yc4, .table th.tinytable_css_pjjbjry2byujm9pu0yc4 {    text-align: left; }
.table td.tinytable_css_dqqwv0vdwj22mw55dj78, .table th.tinytable_css_dqqwv0vdwj22mw55dj78 {    text-align: center; }
.table td.tinytable_css_zze6setfg0i7a9qr1p7t, .table th.tinytable_css_zze6setfg0i7a9qr1p7t {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_000epqhktawt9i57fg7a" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)</td>
                  <td>est = 1.187 (se = 0.249, t = 4.770)***</td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = &lt;0.001, CI = [0.698, 1.676]       </td>
                </tr>
                <tr>
                  <td>T          </td>
                  <td>est = 0.332 (se = 0.096, t = 3.449)***</td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = &lt;0.001, CI = [0.143, 0.521]       </td>
                </tr>
                <tr>
                  <td>X1         </td>
                  <td>est = 0.272 (se = 0.090, t = 3.007)** </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = 0.003, CI = [0.094, 0.450]        </td>
                </tr>
                <tr>
                  <td>X2         </td>
                  <td>est = 0.137 (se = 0.100, t = 1.370)   </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>p = 0.171, CI = [-0.060, 0.333]       </td>
                </tr>
                <tr>
                  <td>R2         </td>
                  <td>0.046                                 </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_4im4kgy9rxl4nbepwrmd(i, j, css_id) {
        var table = document.getElementById("tinytable_000epqhktawt9i57fg7a");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_000epqhktawt9i57fg7a');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_4im4kgy9rxl4nbepwrmd(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_000epqhktawt9i57fg7a");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(0, 0, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(0, 1, 'tinytable_css_euimo2rfkquw8qy4ra7k') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(0, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(1, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(2, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(3, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(4, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(5, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(6, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(7, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(8, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(9, 0, 'tinytable_css_pjjbjry2byujm9pu0yc4') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(0, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(1, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(2, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(3, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(4, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(5, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(6, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(7, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(8, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(9, 1, 'tinytable_css_dqqwv0vdwj22mw55dj78') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(8, 0, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
window.addEventListener('load', function () { styleCell_tinytable_4im4kgy9rxl4nbepwrmd(8, 1, 'tinytable_css_zze6setfg0i7a9qr1p7t') })
    </script>

  


</div>
</div>
</section></section>
<section id="section" class="title-slide slide level1 center center-x" data-state="hide-menubar">
<h1></h1>
<style>
.table-text {
  text-align: center !important;
  font-size: 2em;
  padding-bottom: 1em !important;
}
.row-bottom {
  text-align: center !important;
  padding-top: 2em !important;
}
</style>
<table width="100%">
<tbody>
<tr>
<td colspan="2" class="table-text">
Thank you for your attention!
</td>
</tr>
<tr>
<td class="row-bottom" style="vertical-align: baseline; width: 50%;">
<img src="https://raw.githubusercontent.com/christophihl/TIE_website/main/assets/images/logo.svg" style="vertical-align: middle; width: 60%; height: auto;"> <img src="author_pic.jpg" class="picture" style="vertical-align: middle; horizontal-align: right; width: 30%; height: auto;">
</td>
<td class="row-bottom" style="vertical-align: middle; width = 50%">
<ul style="list-style:none;">
<li>
<a href="https://www.startupengineer.io/authors/ihl/" target="_blank"><i class="fas fa-home"></i> startupengineer.io/authors/ihl</a>
</li>
<li>
<a href="https://www.linkedin.com/in/christoph-ihl/" target="_blank"><i class="fab fa-linkedin"></i> christoph-ihl</a>
</li>
<li>
<a href="https://github.com/christophihl" target="_blank"><i class="fab fa-github"></i> christophihl</a>
</li>
<li>
<a href="https://twitter.com/Ihluminate/" target="_blank"><i class="fab fa-twitter"></i> Ihluminate</a>
</li>
</ul>
</td>
</tr>
</tbody>
</table>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">
<p>Causal Data Science: (3) Randomized Experiments</p>
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/simplemenu/SimpleMenu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-toggle-dark-mode/toggledarkmode.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-fullscreen-button/screenfull.min.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-fullscreen-button/FullscreenButton.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'simplemenu': {"auto":true,"menubarclass":"menubar","barhtml":{"header":"<div class='menubar'><ul class='menu'></ul><div>"},"scale":0.67},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, Simplemenu, RevealToggleDarkMode, RevealFullscreenButton, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>