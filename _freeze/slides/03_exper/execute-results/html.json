{
  "hash": "f5b8f5376874bf47f9764d426ea8f534",
  "result": {
    "engine": "knitr",
    "markdown": "---\n# TITLE & AUTHOR\ntitle: \"(3) Randomized Experiments\"\nsubtitle: \"Causal Data Science for Business Analytics\"\nauthor: \"Christoph Ihl\"\ninstitute: \"Hamburg University of Technology\"\ndate: today\ndate-format: \"dddd, D. MMMM YYYY\"\n# FORMAT OPTIONS\nformat: \n  revealjs:\n    width: 1600\n    height: 900\n    footer: \"Causal Data Science: (3) Randomized Experiments\"\n    slide-number: true\n---\n\n\n\n\n# Randomized Experiments {data-stack-name=\"Randomization\"}\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n<style type=\"text/css\">\ndiv.callout-note{border-left-color:#00C1D4 !important}div.callout-note.callout-style-default .callout-title{background-color:#005e73;color:white}.callout.callout-style-default{border-left:solid #005e73 .3rem;border-right:solid 1px #005e73;border-top:solid 1px #005e73;border-bottom:solid 1px #005e73}\n</style>\n:::\n\n\n\n\n## Randomizing\n\n\n::: {.nonincremental}\n- Randomized treatment assignment:\n  - $P(T_i = t) = \\frac{1}{k}$ where $k$ is the number of treatment groups / values\n  \n::: {.callout-note icon=false}\n\n## Definition 3.1: \"Covariate Balance\"\n\nWe have covariate balance if the distribution of covariates $\\mathbf{X}$ is the same across treatment groups. \n\nFormally: \n\n$P(\\mathbf{X} | T = t) \\stackrel{d}{=} P(\\mathbf{X} | T = t')$ for all $t, t'$.\n\n$\\mathbf{X} \\perp\\!\\!\\!\\perp T$.\n\n:::\n\n:::\n\n- Randomization implies covariate balance, across all covariates, even **unobserved** ones.\n\n\n## Randomizing: \"Association becomes Causation\" \n\n::: {.incremental}\n- `Perspective 1a: \"Graphical Models: Backdoor Adjustment\"`\n  - Let $\\mathbf{X}$ be a sufficient adjustment including all (un-) observed confounders, hence:\n    - $P(Y | do(T = t)) = \\sum_x P(Y | T = t, \\mathbf{X} = \\mathbf{x})P(\\mathbf{X})$\n  - By multiplying by $\\frac{P(T = t | \\mathbf{X} = \\mathbf{x})}{P(T = t | \\mathbf{X} = \\mathbf{x})}$, we get the joint distribution in the numerator:\n    - $P(Y | do(T = t)) = \\sum_x \\frac{P(Y | T= t, \\mathbf{X} = \\mathbf{x})P(T = t | \\mathbf{X} = \\mathbf{x})P(x)}{P(T = t | \\mathbf{X} = \\mathbf{x})} = \\sum_x \\frac{P(Y, T, \\mathbf{X})}{P(T = t | \\mathbf{X} = \\mathbf{x})}$\n  - Now, we use the important result from randomization that  $\\mathbf{X} \\perp\\!\\!\\!\\perp T$:\n    - $P(Y | do(T = t)) = \\sum_x \\frac{P(Y, T, \\mathbf{X})}{P(T)}$\n  - By definition of conditional probabilities and marginalization we obtain q.e.d.:\n    - $P(Y | do(T = t)) = \\sum_x P(Y, \\mathbf{X} | T = t) = P(Y | T = t)$\n:::\n\n\n## Randomizing: \"Association becomes Causation\"\n\n::: {.nonincremental}\n- `Perspective 1b: \"Graphical Models: do-Operator\"` \n  - all backdoor paths are blocked\n  - i.e. backdoor adjustment on empty set $\\emptyset$ suffices\n  - $P(Y | \\text{do}(T = t)) = P(Y | T = t)$\n:::\n\n\n::: {.columns}\n\n\n::: {.column width=\"50%\"}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n:::\n\n\n\n\n\n## Randomizing: \"Association becomes Causation\" {.smaller}\n\n::: {.incremental}\n- `Perspective 2: \"Potential Outcomes\" (Review & Extension)\"`\n  - Causation:\n    - $ATE_{cs} = \\mathbb{E}[Y_i(1) - Y_i(0)]$\n  - Extend by probability $p$ of being in a subgroup:\n    - $ATE_{cs} = p\\underbrace{(\\mathbb{E}[Y_i(1) - Y_i(0)|T_i=1])}_{\\text{ATT}} + (1-p)\\underbrace{(\\mathbb{E}[Y_i(1) - Y_i(0)|T_i=0])}_{\\text{ATU}}$\n    - $ATE_{cs} = p\\mathbb{E}[Y_i(1)|T_i=1] - p\\mathbb{E}Y_i(0)|T_i=1] + (1-p)\\mathbb{E}[Y_i(1)|T_i=0] - (1-p)\\mathbb{E}Y_i(0)|T_i=0]$\n    - $ATE_{cs} = p\\mu_{11} - p\\mu_{01} + (1-p)\\mu_{10} - (1-p)\\mu_{00}$\n  - Association: \n    - $ATE_{as} = \\mathbb{E}[Y_i|T_i=1] - \\mathbb{E}[Y_i|T_i=0] = \\mathbb{E}[Y_i(1)|T_i=1] - \\mathbb{E}[Y_i(0)|T_i=0] = \\mu_{11} - \\mu_{00}$\n  - Add & subtract ATE:\n    - $ATE_{as} = \\color{#00C1D4}{ATE} + \\mu_{11} - \\mu_{00} - \\color{#00C1D4}{p\\mu_{11} + p\\mu_{01} - (1-p)\\mu_{10} + (1-p)\\mu_{00}}$\n   - Add & subtract $(1-p)\\mu_{01}$:\n      - $ATE_{as} = ATE + \\mu_{11} - \\mu_{00} - p\\mu_{11} + \\underbrace{p\\mu_{01} \\color{#00C1D4}{+ (1-p)\\mu_{01}}}_{=\\mu_{01}} - (1-p)\\mu_{10} + (1-p)\\mu_{00} \\color{#00C1D4}{- (1-p)\\mu_{01}}$\n  \n:::\n\n\n## Randomizing: \"Association becomes Causation\" {.smaller}\n\n::: {.incremental}\n- `Perspective 2: \"Potential Outcomes\" (Review & Extension)\"`\n  - Rearrange:\n    - $ATE_{as} = ATE + \\mu_{01} - \\mu_{00} +  \\underbrace{\\mu_{11} - p\\mu_{11}}_{=(1-p)\\mu_{11}} - (1-p)\\mu_{10} + (1-p)\\mu_{00} - (1-p)\\mu_{01}$\n    - $ATE_{as} = ATE + \\mu_{01} - \\mu_{00} +  (1-p)[\\underbrace{\\mu_{11} - \\mu_{01}}_{\\text{ATT}} - \\underbrace{(\\mu_{10} - \\mu_{00})}_{\\text{ATU}}]$\n  - Therefore:\n:::\n\n::: {.fragment}\n\n$$\n\\begin{align}\nATE_{as} &= \\underbrace{\\mathbb{E}[Y_i(1) - Y_i(0)]}_{ATE_{cs}} \\\\ &+ \\underbrace{\\mathbb{E}[Y_i(0)|T_i=1] - \\mathbb{E}Y_i(0)|T_i=0]}_{\\text{Confounding Bias}} \\\\ &+ \\underbrace{(1-\\mathbb{E}[T_i])[\\underbrace{\\mathbb{E}[Y_i(1)|T_i=1] - \\mathbb{E}[Y_i(0)|T_i=1]}_{\\text{ATT}} - \\underbrace{(\\mathbb{E}[Y_i(1)|T_i=0] - \\mathbb{E}[Y_i(0)|T_i=0])}_{\\text{ATU}}]}_{\\text{Heterogeneity Bias}}\n\\end{align}\n$$\n\n:::\n  \n  \n\n## Randomizing: \"Association becomes Causation\" {.smaller}\n\n::: {.incremental}\n- `Perspective 2: \"Potential Outcomes - Exchangeability\"` implies $\\{Y(1), Y(0)\\} \\perp\\!\\!\\!\\perp T$.\n  - Exchangeability **before** treatment: $\\color{#00C1D4}{\\mathbb{E}[Y_i(0)|T_i=0] = \\mathbb{E}[Y_i(0)|T_i=1] = \\mathbb{E}[Y_i(0)]}$ \n  - Exchangeability **after** treatment: $\\color{#FF7E15}{\\mathbb{E}[Y_i(1)|T_i=1] = \\mathbb{E}[Y_i(1)|T_i=0] = \\mathbb{E}[Y_i(1)]}$\n:::\n\n\n::: {.fragment}\n\n$$\n\\begin{align}\nATE_{as} &= \\underbrace{\\mathbb{E}[Y_i(1) - Y_i(0)]}_{ATE_{cs}} \\\\ &+ \\underbrace{\\mathbb{E}[Y_i(0)|T_i=1] - \\mathbb{E}Y_i(0)|T_i=0]}_{\\color{#00C1D4}{\\text{Confounding Bias = 0}}} \\\\ &+ \\underbrace{(1-\\mathbb{E}[T_i])[\\underbrace{\\mathbb{E}[Y_i(1)|T_i=1] - \\mathbb{E}[Y_i(0)|T_i=1]}_{\\text{ATT}} - \\underbrace{(\\mathbb{E}[Y_i(1)|T_i=0] - \\mathbb{E}[Y_i(0)|T_i=0])}_{\\text{ATU}}]}_{\\color{#FF7E15}{\\text{Heterogeneity Bias = 0}}}\n\\end{align}\n$$\n:::\n\n\n\n\n\n# Effect Identification {data-stack-name=\"Identification\"}\n\n## Identification of ATE in Experiments\n\n- `Identification`: \n  - expressing the inherently unobservable ATE in terms of observable quantities.\n  - remove confounding and heterogeneity bias by randomization or addional assumptions.\n  <br> <br>\n  \n::: {.fragment}\n- Using randomization of $T$, the **mean comparison** identifies the ATE:\n  - $\\tau_{\\text{ATE}} = \\mathbb{E}[Y_i(1) - Y_i(0)] = \\mathbb{E}[Y_i|T_i=1] - \\mathbb{E}[Y_i|T_i=0]$\n:::\n\n::: {.fragment}\n- Mean comparison in a sample (rather than the population) is given by:\n  - $\\hat{\\tau}_{\\text{ATE}} = \\frac{1}{\\sum_i T_i} \\sum_i T_i Y_i - \\frac{1}{\\sum_i (1 - T_i)} \\sum_i (1 - T_i) Y_i$\n:::\n\n\n## Identification of ATE in Experiments: Example\n\n- Experiment conducted between November 1994 and February 1996:\n  - Randomized access to *Job Corps*: education program financed by the U.S. Department of Labor that targets disadvantaged individuals aged 16 to 24. \n\n::: {.source}\nSource: Schochet, Burghardt, and Glazerman (2001); Schochet, Burghardt, and McConnell (2008).\n:::\n  - Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(causalweight)             # load causalweight package that inclkudes the data\ndata(JC)                          # load JC data\nT=JC$assignment                   # define treatment (assignment to JC)\nY=JC$earny4                       # define outcome (earnings in fourth year)\nmean((Y[T==0]))                   # compute mean earnings in control group\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 197.9258\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(Y[T==1])-mean(Y[T==0])       # compute the ATE \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 16.05513\n```\n\n\n:::\n:::\n\n\n\n\n## Identification of CATE in Experiments\n\n- Also `conditional independence` holds in a properly randomized experiment: \n  - $\\{Y(1), Y(0)\\} \\perp\\!\\!\\!\\perp T | X$\n    <br> <br>\n- Hence, the `Conditional Average Treatment Effect (CATE)` is also identified:\n  - $\\tau_{\\text{CATE}}(x) = \\mathbb{E}[Y_i(1) - Y_i(0)|X_i=x] = \\mathbb{E}[Y_i|T_i=1, X_i=x] - \\mathbb{E}[Y_i|T_i=0, X_i=x]$\n  \n::: {.fragment}\n- Note that we condition on variables that are not affected by the treatment (e.g., pre-treatment covariates $X$)\n  - This is implied by writing $X$ and not $X(T)$.\n- We will learn about estimators of CATEs in an own session on `Effect Heterogeneity`.\n\n:::\n\n## Effect Identification by Linear Regression {.smaller}\n\n- ATE as mean comparison can also be expressed as a linear regression problem:\n- Start with the observed outcome for each i:\n  - $Y_i = Y_i(1) * T_i + Y_i(0) * (1 - T_i)$\n  - $Y_i = Y_i(0) + (Y_i(1) - Y_i(0)) * T_i$\n  \n::: {.fragment}\n- Take the conditional expectation of this expression given T in the population:\n  - $\\mathbb{E}[Y_i|T_i] = \\mathbb{E}[Y_i(0) + (Y_i(1) - Y_i(0)) * T_i]$\n  - $\\mathbb{E}[Y_i|T_i] = \\mathbb{E}[Y_i(0)|T_i] + ( \\mathbb{E}[Y_i(1)|T_i] - \\mathbb{E}[Y_i(0)|T_i] ) * T_i$\n  \n:::\n\n::: {.fragment}\n\n- With ignorability/ exchangeability we obtain:\n  - $\\mathbb{E}[Y_i|T_i] = \\underbrace{\\mathbb{E}[Y_i|T_i = 0]}_{\\beta_0} + \\underbrace{( \\mathbb{E}[Y_i|T_i = 1] - \\mathbb{E}[Y_i|T_i = 0] )}_{\\beta_1} * T_i$\n\n:::\n\n\n## Effect Identification by Linear Regression\n\n- $\\epsilon$ is commonly referred to as error term or residual and formally defined as follows:\n  - $\\epsilon_i = Y_i - \\underbrace{(\\beta_0 + \\beta_1 * T_i)}_{\\mathbb{E}[Y_i|T_i]}$\n  \n::: {.fragment}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=960}\n:::\n:::\n\n  \n:::\n\n\n\n## Estimation By Linear Regression {.smaller}\n\n- We obtain the ATE based on linear regression by minimizing the sum of squared residuals in the sample:\n  - $\\hat{\\beta_0}, \\hat{\\beta_1} = \\arg \\min_{\\beta_0^*, \\beta_1^*} \\sum_{i=1}^{n} \\underbrace{(Y_i - \\beta_0^* - \\beta_1^* T_i)^2}_{\\epsilon_i}$\n\n::: {.fragment}\n\n- Solving this minimization problem yields the following parameter estimates:\n  - $\\hat{\\beta_1} = \\frac{\\text{Cov}(Y_i, T_i)}{\\text{Var}(T_i)}, \\text{ where}$\n  - $\\text{Cov}(Y_i, T_i) = \\frac{1}{n - 1} \\sum_{i=1}^{n} \\left(Y_i - \\frac{1}{n}\\sum_{i=1}^{n}Y_i\\right)\\left(T_i - \\frac{1}{n}\\sum_{i=1}^{n}T_i\\right), \\text{and}$\n  - $\\text{Var}(T_i) = \\frac{1}{n - 1} \\sum_{i=1}^{n} \\left(T_i - \\frac{1}{n}\\sum_{i=1}^{n}T_i\\right)^2$\n  - $\\hat{\\beta_0} = -\\frac{1}{n}\\sum_{i=1}^{n} Y_i - \\hat{\\beta_1}\\frac{1}{n}\\sum_{i=1}^{n} T_i$\n  \n:::\n\n\n\n# Statistical Inference {data-stack-name=\"Inference\"}\n\n\n## Properties of Regression Estimates {.smaller}\n\n- `Unbiased`: on average, equal to the true parameter values across different samples:\n  - $\\mathbb{E}[\\hat{\\beta_1}] = \\beta_1, \\text{ and}$\n  - $\\mathbb{E}[\\hat{\\beta_0}] = \\beta_0$\n- `Consistent`: converges in probability to the true parameter values as sample size increases:\n  - $\\hat{\\beta_1} \\xrightarrow{p} \\beta_1, \\text{ and}$\n  - $\\hat{\\beta_0} \\xrightarrow{p} \\beta_0$\n- `Asymptotically normally distributed`: follows a normal distribution across suffciently large samples:\n  - $\\sqrt{n}(\\hat{\\beta_1} - \\beta_1) \\xrightarrow{d} \\mathcal{N}(0, \\sigma^2_{\\beta_1}), \\text{ and}$\n  - $\\sqrt{n}(\\hat{\\beta_0} - \\beta_0) \\xrightarrow{d} \\mathcal{N}(0, \\sigma^2_{\\beta_0})$\n  \n::: {.fragment}\n::: {.source}\nNote: We skip the proofs here. They can be found in any introductory econometrics textbook such as Wooldridge (2010): Econometric Analysis of Cross Section and Panel Data (MIT Press) .\n:::\n:::\n\n\n## Inference Goals\n\n- Quantifying the precision or uncertainty of the parameter estimates:\n  - With which error probability can we rule out that the ATE is equal to zero (or some other value we are interested in) in the population, given the ATE estimate in our sample? \n  - What is the range or interval of values that likely includes the ATE in the population, given the finndings in our sample?\n  - `Standard errors (SE)`: measure the variability of the estimated ATE across different samples\n  - `Hypothesis tests`: assess whether the estimated ATE is statistically different from zero\n  - `Confidence intervals (CI)`: provide a range of plausible values for the true ATE\n\n  \n  \n  \n## Standard Errors {.smaller}\n\n- Asymptotic variance of the ATE unknown as it relies on population parameters:\n  - $\\text{Var}(\\hat{\\beta_1}) = \\frac{\\mathbb{E}[\\epsilon^2 \\cdot (T_i - \\mathbb{E}[T_i])^2]}{n \\cdot (\\text{Var}(T_i))^2}$\n- Start with a variance estimator of ATE in the sample:\n  - $\\widehat{\\text{Var}}(\\hat{\\beta_1}) = \\frac{\\frac{1}{n} \\sum_{i=1}^{n} \\hat{\\epsilon}_i^2 \\cdot \\left( T_i - \\frac{1}{n} \\sum_{i=1}^{n} T_i \\right)^2}{n \\cdot \\left( \\widehat{\\text{Var}}(T_i) \\right)^2}$ with $\\hat{\\epsilon}_i = Y_i - \\hat{\\beta_0} - \\hat{\\beta_1} T_i$\n- Standard error of the ATE estimate:\n  - $se(\\hat{\\beta_1}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{\\beta_1})}$\n- Obtain the standard *normal* vs *t* distribution:\n  - $z_1 = \\frac{\\hat{\\beta_1} - \\beta_1}{sd(\\hat{\\beta_1})} \\xrightarrow{d} \\mathcal{N}(0, 1)$ vs $t_1 = \\frac{\\hat{\\beta_1} - \\beta_1}{se(\\hat{\\beta_1})} \\sim t_{n-2}$\n  \n  \n## t-Distribution {.scrollable}\n\n- The t-distribution is a family of distributions indexed by the degrees of freedom (df):\n  - $t_{df} = \\frac{Z}{\\sqrt{V/df}}$, where $Z \\sim \\mathcal{N}(0, 1)$ and $V \\sim \\chi^2(df)$\n- How likely is a specific t-value computed from a sample if the true ATE in the population is zero?\n\n::: {.columns}\n\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::\n\n\n::: {.column width=\"50%\"}\n\n\n\n\n\n::: {.cell layout-align=\"center\" output-location='column'}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::\n\n:::\n\n\n\n## Hypothesis Testing {.smaller}\n\n- **Step 1:** Define the null hypothesis $H_0$ and alternative hypothesis $H_1$: <br>\n  - Two-sided, undirected test: \n    - $H_0$: $\\beta_1 = 0$ and $H_1$: $\\beta_1 \\neq 0$\n  - One-sided, directed test: \n    - $H_0$: $\\beta_1 \\leq 0$ and $H_1$: $\\beta_1 > 0$\n    - $H_0$: $\\beta_1 \\geq 0$ and $H_1$: $\\beta_1 < 0$\n\n::: {.fragment}\n- **Step 2:** Set the significance level $\\alpha$:\n  - maximally accepted type I error probability of incorrectly rejecting H0 and accepting H1\n  - $\\alpha = 0.05$ implies that the error probability must not exceed 5%\n  - other conventional levels of significance are 0.01 (1%) or 0.1 (10%)\n:::\n\n\n## Hypothesis Testing {.smaller}\n\n- **Step 3:** Compute the critical value $c$:\n  - Quantile in the t-distribution that corresponds to $\\alpha$, given $H_0$ is true\n  - Two-sided, undirected test and $\\alpha = 0.05$: $c = t_{\\alpha/2 = 0.025, 1000-2} = 1.96$\n  - One-sided, directed test and $\\alpha = 0.05$: $c = t_{\\alpha = 0.05, 1000-2} = 1.65$\n\n  \n::: {.fragment}\n- **Step 4:** Compute the t-statistic and p-value:\n  - `Test statistic`: $t_1 = \\frac{\\hat{\\beta_1} - 0}{se(\\hat{\\beta_1})}$\n  - `p-value`: probability of observing a test statistic as extreme as $t_1$ under the null hypothesis\n    - Two-sided, undirected test: $p = Pr(|A| \\geq |t_1|)$ \n    - One-sided, directed test: $p = Pr(A \\geq t_1)$ or $p = Pr(A \\leq t_1)$\n  - In a two-sided, undirected test, verify that: \n      - $|t_1| > c$;        $p < \\alpha/2$\n  - In a one-sided, directed test, verify that:\n      - $t_1 > c$ or $t_1 < -c$;        $p < \\alpha$\n:::\n\n\n\n\n## Confidence Intervals {.smaller}\n\n- Range of ATE values such that the true ATE $\\beta_1$ is included with probability $1-\\alpha$, based on the estimated ATE $\\hat{\\beta_1}$ and the standard error $se(\\hat{\\beta_1})$ obtained in the sample\n- Constructed in such a way that in the (hypothetical) case that we could draw many samples and construct confidence intervals in all those samples, a share of $1-\\alpha$ confidence intervals would include the true $\\beta_1$ \n\n- `Two-sided confidence interval`:\n  - $CI = \\hat{\\beta_1} \\pm c \\cdot se(\\hat{\\beta_1})$\n  - e.g. $CI = 0.3 \\pm 1.96 \\cdot 0.05 = [0.202, 0.398]$\n\n- `One-sided confidence interval`:\n  - $CI = \\hat{\\beta_1} + c \\cdot se(\\hat{\\beta_1})$\n  - e.g. $CI = 0.3 - 1.65 \\cdot 0.05 = [0.2175, \\infty]$\n\n\n## R-squared {.smaller}\n\n- `In general`: percentage of variance in the outcome $Y$ that is explained by all variables in the model:\n  - $R^2 = 1 - \\frac{SSR}{SST}$ \n  - $SSR = \\sum_{i=1}^{n} (Y_i - \\hat{Y_i})^2$\n  - $SST = \\sum_{i=1}^{n} (Y_i - \\bar{Y})^2$\n- `Specific case`: just one binary treatment variable $T$ in the model:\n  - $R^2 = r^2$ where $r$ is the correlation between $Y$ and $T$\n  - $R^2 = \\left( \\frac{\\sum_{i=1}^{n} (Y_i - \\bar{Y})(T_i - \\bar{T})}{\\sqrt{\\sum_{i=1}^{n} (Y_i - \\bar{Y})^2} \\cdot \\sqrt{\\sum_{i=1}^{n}(T_i - \\bar{T})^2}} \\right)^2$\n\n\n\n\n## ATE in Experiments: Regression Example {.smaller}\n\n- Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(causalweight)             # load causalweight package \nlibrary(sandwich)                 # load sandwich package\nlibrary(modelsummary)             # load modelsummary package)\ndata(JC)                          # load JC data\nT=JC$assignment                   # define treatment (assignment to JC)\nY=JC$earny4                       # define outcome (earnings in fourth year)\nols=lm(Y~T)                       # run OLS regression\n# display results\nmodelsummary(ols, vcov = sandwich::vcovHC, \n             estimate = \"est = {estimate} (se = {std.error}, t = {statistic}){stars}\", \n             statistic = \"p = {p.value}, CI = [{conf.low}, {conf.high}]\",\n             gof_map = c(\"r.squared\"))   \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_7f2cb0tu5f968o2hresj</title>\n    <style>\n.table td.tinytable_css_ofnwlpjekxo0darhxzje, .table th.tinytable_css_ofnwlpjekxo0darhxzje {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_awdrwszvl64uvhct1r2w, .table th.tinytable_css_awdrwszvl64uvhct1r2w {    text-align: left; }\n.table td.tinytable_css_sj896rho98ie2ljxmghi, .table th.tinytable_css_sj896rho98ie2ljxmghi {    text-align: center; }\n.table td.tinytable_css_gt99x3opwli5oto18a5u, .table th.tinytable_css_gt99x3opwli5oto18a5u {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_7f2cb0tu5f968o2hresj\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>est = 197.926 (se = 3.073, t = 64.416)***</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = <0.001, CI = [191.903, 203.949]      </td>\n                </tr>\n                <tr>\n                  <td>T          </td>\n                  <td>est = 16.055 (se = 4.074, t = 3.941)***  </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = <0.001, CI = [8.069, 24.041]         </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.002                                    </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_nxordx1uvq9r94yddrwy(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_7f2cb0tu5f968o2hresj\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_7f2cb0tu5f968o2hresj');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_nxordx1uvq9r94yddrwy(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_7f2cb0tu5f968o2hresj\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(0, 0, 'tinytable_css_ofnwlpjekxo0darhxzje') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(0, 1, 'tinytable_css_ofnwlpjekxo0darhxzje') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(0, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(1, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(2, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(3, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(4, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(5, 0, 'tinytable_css_awdrwszvl64uvhct1r2w') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(0, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(1, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(2, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(3, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(4, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(5, 1, 'tinytable_css_sj896rho98ie2ljxmghi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(4, 0, 'tinytable_css_gt99x3opwli5oto18a5u') })\nwindow.addEventListener('load', function () { styleCell_tinytable_nxordx1uvq9r94yddrwy(4, 1, 'tinytable_css_gt99x3opwli5oto18a5u') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\n\n## Bootstrapping {.smaller}\n\n- `Bootstrap sampling`: $B$ randomly drawn samples of the same size as the original sample, with replacement\n- Calculate the ATE in each bootstrap sample via regression\n\n\n![](_images/3/bootstrap.png){fig-align=\"center\" height=300}\n\n::: {.source}\nSource: Huber, Martin (2023). Causal analysis: Impact evaluation and Causal Machine Learning with applications in R. MIT Press, 2023.\n:::\n\n- Calculate the standard error by: $se(\\hat{\\beta_1}) = \\sqrt{\\frac{1}{B - 1} \\sum_{b=1}^{B} \\left(\\hat{\\beta_1^b} - \\frac{1}{B}\\sum_{b=1}^{B}\\hat{\\beta_1^b}\\right)^2}$\n\n\n\n## ATE in Experiments: Bootstrapping Example {.smaller}\n\n- Assess the ATE of the program on the weekly earnings in the fourth year after the assignment among 9.240 individuals.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(causalweight)             # load causalweight package \nlibrary(boot)                     # load boot package\ndata(JC)                          # load JC data\nT=JC$assignment                   # define treatment (assignment to JC)\nY=JC$earny4                       # define outcome (earnings in fourth year)\nbootdata=data.frame(Y,T)          # data frame with Y,D for bootstrap procedure\nbs=function(data, indices) {      # defines function bs for bootstrapping\n  dat=data[indices,]              # creates bootstrap sample according to indices \n  coefficients=lm(dat)$coef       # estimates coefficients in bootstrap sample  \n  return(coefficients)            # returns coefficients\n}                                 # closes the function bs  \nset.seed(1)                       # set seed\nresults = boot(data=bootdata, statistic=bs, R=1999) # 1999 bootstrap estimations \nresults                           # displays the results \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nORDINARY NONPARAMETRIC BOOTSTRAP\n\n\nCall:\nboot(data = bootdata, statistic = bs, R = 1999)\n\n\nBootstrap Statistics :\n     original      bias    std. error\nt1* 197.92584  0.02480312    3.013465\nt2*  16.05513 -0.02075945    3.954810\n```\n\n\n:::\n\n```{.r .cell-code}\ntstat=results$t0[2]/sd(results$t[,2])  # compute the t-statistic\n2*pnorm(-abs(tstat))                   # compute the p-value asssuming standard normal distribution\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           T \n4.914718e-05 \n```\n\n\n:::\n:::\n\n\n\n\n\n# Extensions {data-stack-name=\"Extensions\"}\n\n## Multivalued Treatments {.smaller}\n\n- Treatment can take on discrete values, which can be ordered or unordered:\n  - $T = 0, 1, 2, ...$: 0 = 0 weeks of training, 1 = 1 week of training, 2 = 2 weeks of training, ...\n  - $T = A, B, C, ...$: A = no training, B = IT training, C = management training, ...\n\n::: {.fragment}\n- Independence assumption can be adapted to hold for any treatment value: \n  - $Y_i(0), Y_i(1), Y_i(2), ..., Y_i(J) \\perp\\!\\!\\!\\perp T_i$\n:::\n\n::: {.fragment}\n- Analyze the ATEs of each non-zero treatment in a linear regression by including binary **dummy** variables for each:\n  - $\\mathbb{E}[Y_i | T_i] = \\underbrace{\\beta_0}_{E[Y_i | T_i=0]} + \\underbrace{\\beta_1}_{E[Y_i | T_i=1] - E[Y_i | T_i=0]} T_{i1} + \\underbrace{\\beta_2}_{E[Y_i |  T_i=2] - E[Y_i |  T_i=0]} T_{i2} + \\dots + \\underbrace{\\beta_J}_{E[Y_i | T_i=J] - E[Y_i | T_i=0]} T_{iJ}$\n  - $T_{ij} = 1$ if $T_i = j$ and $T_{ij} = 0$ otherwise\n:::\n\n\n\n## Multivalued Treatments: Example {.smaller}\n\n- Assess wage expectations (measure in brackets of 500 EUR) of 804 university students based on two-level treatment:\n  - `treatmentinformation`: Graph with information on monthly gross private sector earnings shown.\n  - `treatmentorder`: Reversed order of questions about professional and personal preferences (\"framing\").\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(causalweight)             # load causalweight package \ndata(wexpect)                     # load wexpect data\nT1=wexpect$treatmentinformation   # define first treatment (wage information)\nT2=wexpect$treatmentorder         # define second treatment (order of questions)\nY=wexpect$wexpect2                # define outcome (wage expectations) \nols=lm(Y~T1+T2)                   # run OLS regression\n# display results\nmodelsummary(ols, vcov = sandwich::vcovHC, estimate = \"est = {estimate} (se = {std.error}, t = {statistic}){stars}\", statistic = \"p = {p.value}, CI = [{conf.low}, {conf.high}]\", gof_map = c(\"r.squared\"))   \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_h4kgvpyee44b91na4vbb</title>\n    <style>\n.table td.tinytable_css_os0odwqh5iww7jesqcjv, .table th.tinytable_css_os0odwqh5iww7jesqcjv {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_wn11e72ldz94gv2dylug, .table th.tinytable_css_wn11e72ldz94gv2dylug {    text-align: left; }\n.table td.tinytable_css_zg734ekshke42zws71jp, .table th.tinytable_css_zg734ekshke42zws71jp {    text-align: center; }\n.table td.tinytable_css_cbawm3761p9y8sm3x0ce, .table th.tinytable_css_cbawm3761p9y8sm3x0ce {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_h4kgvpyee44b91na4vbb\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>est = 9.408 (se = 0.159, t = 59.268)***</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = <0.001, CI = [9.096, 9.719]        </td>\n                </tr>\n                <tr>\n                  <td>T1         </td>\n                  <td>est = 0.345 (se = 0.243, t = 1.421)    </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = 0.156, CI = [-0.132, 0.822]        </td>\n                </tr>\n                <tr>\n                  <td>T2         </td>\n                  <td>est = -0.173 (se = 0.234, t = -0.741)  </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = 0.459, CI = [-0.633, 0.286]        </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.006                                  </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_q2fm8wfrya6so0qckfcs(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_h4kgvpyee44b91na4vbb\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_h4kgvpyee44b91na4vbb');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_q2fm8wfrya6so0qckfcs(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_h4kgvpyee44b91na4vbb\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 0, 'tinytable_css_os0odwqh5iww7jesqcjv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 1, 'tinytable_css_os0odwqh5iww7jesqcjv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(1, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(2, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(3, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(4, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(5, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(7, 0, 'tinytable_css_wn11e72ldz94gv2dylug') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(0, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(1, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(2, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(3, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(4, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(5, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(7, 1, 'tinytable_css_zg734ekshke42zws71jp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 0, 'tinytable_css_cbawm3761p9y8sm3x0ce') })\nwindow.addEventListener('load', function () { styleCell_tinytable_q2fm8wfrya6so0qckfcs(6, 1, 'tinytable_css_cbawm3761p9y8sm3x0ce') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\n\n## Continuous Treatments {.smaller}\n\n- Treatment can take on many (even infinitely) different values that respect cardinality.\n  - e.g. marketing expenditure in EUR, years of education, ...\n\n::: {.fragment}\n- Independence assumption to hold for any values of the continuous treatment:\n  - $Y_i(t) \\perp\\!\\!\\!\\perp T_i$\n:::\n\n::: {.fragment}\n- `Discretize` a continuous treatment by generating binary indicators for (very small) brackets of values:\n  - e.g. $T_{i0} = 0$ if $T_i \\leq 100$, $T_{i1} = 1$ if $100 < T_i \\leq 200$, ...\n:::\n\n::: {.fragment}\n- Include $T_i$ as a continuous variable in the regression model:\n  - $\\mathbb{E}[Y_i | T_i] = \\beta_0 + \\beta_1 T_i$\n  - First derivative of the expected value of $Y_i$ with respect to $T_i$ reflects the **marginal effect** of a one-unit increase in $T_i$ on $Y_i$:\n  - $ATE = \\frac{\\partial \\mathbb{E}[Y_i | T_i]}{\\partial T_i} = \\frac{\\partial \\mathbb{E}[Y_i(T_i)]}{\\partial T_i} = \\frac{\\partial \\mathbb{E}[Y_i]}{\\partial T_i} = \\beta_1$\n:::\n\n\n\n## Continuous Treatments: Non-Linearity {.smaller}\n\n- Linearity: $\\frac{\\partial \\mathbb{E}[Y_i(T_i = t')]}{\\partial T_i} = \\frac{\\partial \\mathbb{E}[Y_i(T_i = t)]}{\\partial T_i}$ for any $t' \\neq t$ which $T_i$ can take on\n\n\n::: {.columns}\n\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::\n\n\n::: {.column width=\"50%\"}\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::\n\n:::\n\n::: {.fragment}\n- Quadratic term in the regression model:\n  - $\\mathbb{E}[Y_i | T_i] = \\beta_0 + \\beta_1 T_i + \\beta_2 T_i^2$\n  - $ATE = \\frac{\\partial \\mathbb{E}[Y_i | T_i]}{\\partial T_i} = \\beta_1 + 2 \\beta_2 T_i$\n- Increase model flexibility with higher-order terms (e.g. cubic, ...) or non-parametric splines or kernel regression\n:::\n\n\n\n\n\n## Continuous Treatments: Example {.smaller}\n\n- Assess sales as a function of advertising spending in newspapers on a data set with 200 observations:\n\n\n::: {.columns}\n\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(datarium)                 # load datarium package\nlibrary(np)                       # load np package\ndata(marketing)                   # load marketing data\nT=marketing$newspaper             # define treatment (newspaper advertising)\nY=marketing$sales                 # define outcome (sales)\nresults = npregbw(Y~T)             # kernel regression\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nMultistart 1 of 1 |\nMultistart 1 of 1 |\nMultistart 1 of 1 |\nMultistart 1 of 1 /\nMultistart 1 of 1 |\nMultistart 1 of 1 |\n                   \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(results, plot.errors.method=\"asymptotic\") # plot regression function\n```\n\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(datarium)                 # load datarium package\nlibrary(np)                       # load np package\ndata(marketing)                   # load marketing data\nT=marketing$newspaper             # define treatment (newspaper advertising)\nY=marketing$sales                 # define outcome (sales)\nresults = npregbw(Y~T)             # kernel regression\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nMultistart 1 of 1 |\nMultistart 1 of 1 |\nMultistart 1 of 1 |\nMultistart 1 of 1 /\nMultistart 1 of 1 |\nMultistart 1 of 1 |\n                   \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(results, gradients=TRUE, plot.errors.method=\"asymptotic\") # plot effects\n```\n\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-15-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n:::\n\n\n\n## Including Covariates\n\n- Given successful randomization, there is no need to include covariates in the estimation of the ATE.\n- However, including covariates can reduce variance and thus uncertainty in the estimation of the ATE.\n\n- $Y_i = \\underbrace{\\hat{\\beta_0} + \\hat{\\beta}_1 T_i + \\hat{\\beta}_{X_1} X_{i1} + \\dots + \\hat{\\beta}_{X_K} X_{iK}}_{\\hat{E}[Y_i | T_i, X_i]} + \\hat{\\epsilon}_i$\n\n- $R^2 = \\frac{\\text{Var}(\\hat{E}[Y_i | T_i, X_i])}{\\text{Var}(Y_i)}$ gets larger while $\\frac{\\text{Var}(\\hat{\\epsilon}_i)}{\\text{Var}(Y_i)}$ gets smaller with the inclusion of covariates.\n\n- This further reduces the standard error of the ATE estimate $se(\\hat{\\beta}_1)$.\n\n\n\n\n\n\n## Including Covariates {.smaller}\n\n::: {.columns}\n\n\n::: {.column width=\"30%\"}\n\n- `Pre-treatment covariates`\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n::: {.column width=\"20%\"}\n\n:::\n\n::: {.column width=\"30%\"}\n\n- `Post-treatment covariates`\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03_exper_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::\n\n::: {.column width=\"20%\"}\n\n:::\n\n\n:::\n\n\n::: {.fragment}\n- Controlling for post-treatment covariates is a **bad idea**:\n  - (1) they condition away part of the treatment effect\n  - (2) they introduce association between $T$ and $U$ as colliders and thus harm randomization.\n\n:::\n  \n\n## Including Covariates: Example {.smaller}\n\n- Assess the awareness about environmental issues of 522 university students after randomly receiving or not receiving a leaflet with information about the environmental and social implications of coffee production.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(causalweight)             # load causalweight package \nlibrary(sandwich)                 # load sandwich package\ndata(coffeeleaflet)               # load coffeeleaflet data\nattach(coffeeleaflet)             # store all variables in own objects\nT=c(coffeeleaflet$treatment)         # define treatment (leaflet)\nY=c(coffeeleaflet$awarewaste)                      # define outcome (aware of waste production)\nX=cbind(coffeeleaflet$mumedu,coffeeleaflet$sex)               # define covariates (grade, gender, age)\nols=lm(Y~T+X)                     # run OLS regression\nmodelsummary(ols, vcov = sandwich::vcovHC, estimate = \"est = {estimate} (se = {std.error}, t = {statistic}){stars}\", statistic = \"p = {p.value}, CI = [{conf.low}, {conf.high}]\", gof_map = c(\"r.squared\"))  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_kgy9rxl4nbepwrmdbh6f</title>\n    <style>\n.table td.tinytable_css_b5i17nkworow5izk000e, .table th.tinytable_css_b5i17nkworow5izk000e {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_rz1b0bu09u2g3oa9f6yu, .table th.tinytable_css_rz1b0bu09u2g3oa9f6yu {    text-align: left; }\n.table td.tinytable_css_kpsc37y8c4b3o92gpjjb, .table th.tinytable_css_kpsc37y8c4b3o92gpjjb {    text-align: center; }\n.table td.tinytable_css_jry2byujm9pu0yc4dqqw, .table th.tinytable_css_jry2byujm9pu0yc4dqqw {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_kgy9rxl4nbepwrmdbh6f\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>est = 1.187 (se = 0.249, t = 4.770)***</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = <0.001, CI = [0.698, 1.676]       </td>\n                </tr>\n                <tr>\n                  <td>T          </td>\n                  <td>est = 0.332 (se = 0.096, t = 3.449)***</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = <0.001, CI = [0.143, 0.521]       </td>\n                </tr>\n                <tr>\n                  <td>X1         </td>\n                  <td>est = 0.272 (se = 0.090, t = 3.007)** </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = 0.003, CI = [0.094, 0.450]        </td>\n                </tr>\n                <tr>\n                  <td>X2         </td>\n                  <td>est = 0.137 (se = 0.100, t = 1.370)   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>p = 0.171, CI = [-0.060, 0.333]       </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.046                                 </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_v2xrrt9oibhuh877y799(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_kgy9rxl4nbepwrmdbh6f\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_kgy9rxl4nbepwrmdbh6f');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_v2xrrt9oibhuh877y799(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_kgy9rxl4nbepwrmdbh6f\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(0, 0, 'tinytable_css_b5i17nkworow5izk000e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(0, 1, 'tinytable_css_b5i17nkworow5izk000e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(0, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(1, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(2, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(3, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(4, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(5, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(6, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(7, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(8, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(9, 0, 'tinytable_css_rz1b0bu09u2g3oa9f6yu') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(0, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(1, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(2, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(3, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(4, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(5, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(6, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(7, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(8, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(9, 1, 'tinytable_css_kpsc37y8c4b3o92gpjjb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(8, 0, 'tinytable_css_jry2byujm9pu0yc4dqqw') })\nwindow.addEventListener('load', function () { styleCell_tinytable_v2xrrt9oibhuh877y799(8, 1, 'tinytable_css_jry2byujm9pu0yc4dqqw') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n# {.center .center-x data-state=\"hide-menubar\"}\n<style>\n.table-text {\n  text-align: center !important;\n  font-size: 2em;\n  padding-bottom: 1em !important;\n}\n.row-bottom {\n  text-align: center !important;\n  padding-top: 2em !important;\n}\n</style>\n<table width = \"100%\">\n<tbody>\n  <tr>\n    <td colspan=\"2\" class=\"table-text\">Thank you for your attention!</td>\n  </tr>\n  <tr >\n    <td class=\"row-bottom\" style=\"vertical-align: baseline; width: 50%;\">\n          <img src=\"https://raw.githubusercontent.com/christophihl/TIE_website/main/assets/images/logo.svg\" style=\"vertical-align: middle; width: 60%; height: auto;\" />\n          <img src=\"author_pic.jpg\" class=\"picture\" style=\"vertical-align: middle; horizontal-align: right; width: 30%; height: auto;\" />\n    </td>\n    <td class = \"row-bottom\" style = \"vertical-align: middle; width = 50%\">\n      <ul style = \"list-style:none;\">\n        <li><a href = \"https://www.startupengineer.io/authors/ihl/\" target = \"_blank\"><i class = \"fas fa-home\"></i> startupengineer.io/authors/ihl</a></li>\n        <li><a href = \"https://www.linkedin.com/in/christoph-ihl/\" target = \"_blank\"><i class = \"fab fa-linkedin\"></i> christoph-ihl</a></li>\n        <li><a href = \"https://github.com/christophihl\" target = \"_blank\"><i class = \"fab fa-github\"></i> christophihl</a></li>\n        <li><a href = \"https://twitter.com/Ihluminate/\" target = \"_blank\"><i class = \"fab fa-twitter\"></i> Ihluminate</a></li>\n      </ul>\n    </td>\n  </tr>\n</tbody>\n</table>\n\n",
    "supporting": [
      "03_exper_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}